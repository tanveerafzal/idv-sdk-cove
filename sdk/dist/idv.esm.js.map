{"version":3,"file":"idv.esm.js","sources":["../src/types.ts","../src/MessageBus.ts","../src/ModalManager.ts","../src/IDV.ts","../src/index.ts"],"sourcesContent":["/**\r\n * IDV SDK Configuration\r\n */\r\nexport interface IDVConfig {\r\n  /** Partner API key (required) */\r\n  apiKey: string;\r\n  /** Environment: 'sandbox' or 'production' (default: 'production') */\r\n  environment?: 'sandbox' | 'production';\r\n  /** Override the verification app base URL */\r\n  baseUrl?: string;\r\n  /** Enable debug logging */\r\n  debug?: boolean;\r\n}\r\n\r\n/**\r\n * User context passed to verification\r\n */\r\nexport interface UserContext {\r\n  /** Partner's internal user ID */\r\n  id?: string;\r\n  /** User's email address */\r\n  email?: string;\r\n  /** User's full name */\r\n  name?: string;\r\n}\r\n\r\n/**\r\n * Theme customization options\r\n */\r\nexport interface ThemeOptions {\r\n  /** Primary button/accent color (hex) */\r\n  primaryColor?: string;\r\n  /** Modal background color */\r\n  backgroundColor?: string;\r\n  /** Primary text color */\r\n  textColor?: string;\r\n  /** Font family */\r\n  fontFamily?: string;\r\n  /** Border radius for buttons/cards */\r\n  borderRadius?: string;\r\n  /** Partner logo URL */\r\n  logoUrl?: string;\r\n}\r\n\r\n/**\r\n * Modal behavior options\r\n */\r\nexport interface ModalOptions {\r\n  /** Close modal when clicking overlay (default: false) */\r\n  closeOnOverlayClick?: boolean;\r\n  /** Close modal when pressing ESC (default: true) */\r\n  closeOnEscape?: boolean;\r\n  /** Show close button (default: true) */\r\n  showCloseButton?: boolean;\r\n  /** Prevent body scroll when modal open (default: true) */\r\n  preventScroll?: boolean;\r\n}\r\n\r\n/**\r\n * Options for starting verification\r\n */\r\nexport interface IDVStartOptions {\r\n  /** User context */\r\n  user?: UserContext;\r\n  /** Allowed document types */\r\n  allowedDocumentTypes?: ('passport' | 'drivers_license' | 'id_card')[];\r\n  /** Pre-selected country */\r\n  country?: string;\r\n  /** UI locale (e.g., 'en', 'es', 'fr') */\r\n  locale?: string;\r\n  /** Theme customization */\r\n  theme?: ThemeOptions;\r\n  /** Modal behavior */\r\n  modal?: ModalOptions;\r\n  /** Called when iframe is ready */\r\n  onReady?: () => void;\r\n  /** Called when user starts verification */\r\n  onStart?: () => void;\r\n  /** Called on step progression */\r\n  onStep?: (step: StepInfo) => void;\r\n  /** Called when verification completes */\r\n  onComplete?: (result: VerificationComplete) => void;\r\n  /** Called on error */\r\n  onError?: (error: SDKError) => void;\r\n  /** Called when modal closes */\r\n  onClose?: (reason: CloseReason) => void;\r\n}\r\n\r\n/**\r\n * Step progression info\r\n */\r\nexport interface StepInfo {\r\n  /** Current step name */\r\n  step: 'intro' | 'document_select' | 'document_capture' | 'document_review' |\r\n        'selfie_intro' | 'selfie_capture' | 'selfie_review' | 'processing' | 'complete';\r\n  /** Step number (1-8) */\r\n  stepNumber: number;\r\n  /** Total steps */\r\n  totalSteps: number;\r\n  /** Timestamp */\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Verification result passed to onComplete\r\n */\r\nexport interface VerificationComplete {\r\n  /** Unique verification ID */\r\n  verificationId: string;\r\n  /** Verification status */\r\n  status: 'passed' | 'failed' | 'review';\r\n  /** Result summary */\r\n  result: {\r\n    passed: boolean;\r\n    riskLevel: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';\r\n    message?: string;\r\n  };\r\n  /** Extracted data (if passed and permitted) */\r\n  extractedData?: {\r\n    fullName?: string;\r\n    dateOfBirth?: string;\r\n    documentNumber?: string;\r\n    expiryDate?: string;\r\n    issuingCountry?: string;\r\n  };\r\n  /** Completion timestamp */\r\n  completedAt: string;\r\n  /** Duration in milliseconds */\r\n  duration: number;\r\n}\r\n\r\n/**\r\n * SDK error\r\n */\r\nexport interface SDKError {\r\n  /** Error code */\r\n  code: string;\r\n  /** Human-readable message */\r\n  message: string;\r\n  /** Additional details */\r\n  details?: Record<string, unknown>;\r\n  /** Whether the error is recoverable */\r\n  recoverable: boolean;\r\n}\r\n\r\n/**\r\n * Reason for modal close\r\n */\r\nexport type CloseReason = 'user_closed' | 'completed' | 'error' | 'expired';\r\n\r\n/**\r\n * Message types for postMessage communication\r\n */\r\nexport type MessageType =\r\n  | 'IDV_READY'\r\n  | 'IDV_START'\r\n  | 'IDV_STEP'\r\n  | 'IDV_COMPLETE'\r\n  | 'IDV_ERROR'\r\n  | 'IDV_CLOSE';\r\n\r\n/**\r\n * Message structure for postMessage\r\n */\r\nexport interface SDKMessage<T = unknown> {\r\n  type: MessageType;\r\n  payload: T;\r\n  timestamp: string;\r\n  nonce: string;\r\n}\r\n\r\n/**\r\n * Error codes\r\n */\r\nexport const ErrorCodes = {\r\n  // Initialization\r\n  INVALID_API_KEY: 'INVALID_API_KEY',\r\n  NOT_INITIALIZED: 'NOT_INITIALIZED',\r\n  ALREADY_OPEN: 'ALREADY_OPEN',\r\n\r\n  // Browser\r\n  BROWSER_NOT_SUPPORTED: 'BROWSER_NOT_SUPPORTED',\r\n  CAMERA_PERMISSION_DENIED: 'CAMERA_PERMISSION_DENIED',\r\n  CAMERA_NOT_FOUND: 'CAMERA_NOT_FOUND',\r\n\r\n  // Verification\r\n  VERIFICATION_FAILED: 'VERIFICATION_FAILED',\r\n  DOCUMENT_UNREADABLE: 'DOCUMENT_UNREADABLE',\r\n  FACE_NOT_DETECTED: 'FACE_NOT_DETECTED',\r\n\r\n  // Network\r\n  NETWORK_ERROR: 'NETWORK_ERROR',\r\n  TIMEOUT: 'TIMEOUT',\r\n\r\n  // Session\r\n  SESSION_EXPIRED: 'SESSION_EXPIRED',\r\n} as const;\r\n","import type { MessageType, SDKMessage } from './types';\r\n\r\ntype MessageCallback = (payload: unknown) => void;\r\n\r\n/**\r\n * Handles postMessage communication between parent page and iframe\r\n */\r\nexport class MessageBus {\r\n  private allowedOrigins: string[];\r\n  private callbacks: Map<MessageType, MessageCallback[]> = new Map();\r\n  private processedNonces: Set<string> = new Set();\r\n  private debug: boolean;\r\n  private boundHandler: (event: MessageEvent) => void;\r\n\r\n  constructor(allowedOrigins: string[], debug = false) {\r\n    this.allowedOrigins = allowedOrigins;\r\n    this.debug = debug;\r\n    this.boundHandler = this.handleMessage.bind(this);\r\n    window.addEventListener('message', this.boundHandler);\r\n  }\r\n\r\n  /**\r\n   * Handle incoming postMessage events\r\n   */\r\n  private handleMessage(event: MessageEvent): void {\r\n    // Validate origin\r\n    if (!this.allowedOrigins.some(origin => event.origin === origin || origin === '*')) {\r\n      if (this.debug) {\r\n        console.warn('[IDV SDK] Message from unauthorized origin:', event.origin);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Validate message structure\r\n    const message = event.data as SDKMessage;\r\n    if (!message?.type || typeof message.type !== 'string' || !message.type.startsWith('IDV_')) {\r\n      return;\r\n    }\r\n\r\n    // Prevent replay attacks (skip if no nonce - older messages)\r\n    if (message.nonce) {\r\n      if (this.processedNonces.has(message.nonce)) {\r\n        if (this.debug) {\r\n          console.warn('[IDV SDK] Duplicate nonce detected, ignoring message');\r\n        }\r\n        return;\r\n      }\r\n      this.processedNonces.add(message.nonce);\r\n\r\n      // Clean up old nonces periodically (keep last 100)\r\n      if (this.processedNonces.size > 100) {\r\n        const noncesArray = Array.from(this.processedNonces);\r\n        this.processedNonces = new Set(noncesArray.slice(-50));\r\n      }\r\n    }\r\n\r\n    if (this.debug) {\r\n      console.log('[IDV SDK] Received message:', message.type, message.payload);\r\n    }\r\n\r\n    // Dispatch to registered callbacks\r\n    const handlers = this.callbacks.get(message.type as MessageType) || [];\r\n    handlers.forEach(callback => {\r\n      try {\r\n        callback(message.payload);\r\n      } catch (error) {\r\n        console.error('[IDV SDK] Error in message handler:', error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Register a callback for a message type\r\n   */\r\n  on(type: MessageType, callback: MessageCallback): void {\r\n    const handlers = this.callbacks.get(type) || [];\r\n    handlers.push(callback);\r\n    this.callbacks.set(type, handlers);\r\n  }\r\n\r\n  /**\r\n   * Unregister a callback\r\n   */\r\n  off(type: MessageType, callback: MessageCallback): void {\r\n    const handlers = this.callbacks.get(type) || [];\r\n    const index = handlers.indexOf(callback);\r\n    if (index > -1) {\r\n      handlers.splice(index, 1);\r\n      this.callbacks.set(type, handlers);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all callbacks for a message type\r\n   */\r\n  removeAllListeners(type?: MessageType): void {\r\n    if (type) {\r\n      this.callbacks.delete(type);\r\n    } else {\r\n      this.callbacks.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up and remove event listener\r\n   */\r\n  destroy(): void {\r\n    window.removeEventListener('message', this.boundHandler);\r\n    this.callbacks.clear();\r\n    this.processedNonces.clear();\r\n  }\r\n}\r\n","import type { ModalOptions, ThemeOptions, CloseReason } from './types';\r\n\r\nexport interface ModalConfig {\r\n  iframeSrc: string;\r\n  theme?: ThemeOptions;\r\n  modal?: ModalOptions;\r\n  onClose?: (reason: CloseReason) => void;\r\n}\r\n\r\n/**\r\n * Manages the modal overlay and iframe\r\n */\r\nexport class ModalManager {\r\n  private overlay: HTMLDivElement | null = null;\r\n  private container: HTMLDivElement | null = null;\r\n  private iframe: HTMLIFrameElement | null = null;\r\n  private config: ModalConfig;\r\n  private originalOverflow: string = '';\r\n  private escHandler: ((e: KeyboardEvent) => void) | null = null;\r\n\r\n  constructor(config: ModalConfig) {\r\n    this.config = config;\r\n  }\r\n\r\n  /**\r\n   * Open the modal with iframe\r\n   */\r\n  open(): void {\r\n    if (this.overlay) {\r\n      return; // Already open\r\n    }\r\n\r\n    this.createOverlay();\r\n    this.createContainer();\r\n    this.createIframe();\r\n    this.attachEventListeners();\r\n    this.preventScroll();\r\n    this.animateIn();\r\n  }\r\n\r\n  /**\r\n   * Close the modal\r\n   */\r\n  close(reason: CloseReason = 'user_closed'): void {\r\n    if (!this.overlay) {\r\n      return;\r\n    }\r\n\r\n    this.animateOut(() => {\r\n      this.cleanup();\r\n      this.config.onClose?.(reason);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the iframe element\r\n   */\r\n  getIframe(): HTMLIFrameElement | null {\r\n    return this.iframe;\r\n  }\r\n\r\n  /**\r\n   * Check if modal is open\r\n   */\r\n  isOpen(): boolean {\r\n    return this.overlay !== null;\r\n  }\r\n\r\n  private createOverlay(): void {\r\n    this.overlay = document.createElement('div');\r\n    this.overlay.id = 'idv-sdk-overlay';\r\n    this.overlay.setAttribute('role', 'dialog');\r\n    this.overlay.setAttribute('aria-modal', 'true');\r\n    this.overlay.setAttribute('aria-label', 'Identity Verification');\r\n\r\n    Object.assign(this.overlay.style, {\r\n      position: 'fixed',\r\n      top: '0',\r\n      left: '0',\r\n      right: '0',\r\n      bottom: '0',\r\n      backgroundColor: 'rgba(0, 0, 0, 0.6)',\r\n      zIndex: '2147483647',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      opacity: '0',\r\n      transition: 'opacity 0.2s ease-out',\r\n    });\r\n\r\n    document.body.appendChild(this.overlay);\r\n  }\r\n\r\n  private isMobile(): boolean {\r\n    return window.innerWidth <= 480 || /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\r\n  }\r\n\r\n  private createContainer(): void {\r\n    const theme = this.config.theme || {};\r\n    const mobile = this.isMobile();\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.id = 'idv-sdk-modal';\r\n\r\n    // Use full screen on mobile, modal on desktop\r\n    if (mobile) {\r\n      Object.assign(this.container.style, {\r\n        width: '100%',\r\n        height: '100%',\r\n        backgroundColor: theme.backgroundColor || '#ffffff',\r\n        borderRadius: '0',\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        transform: 'translateY(20px)',\r\n        transition: 'transform 0.2s ease-out',\r\n      });\r\n    } else {\r\n      Object.assign(this.container.style, {\r\n        width: '100%',\r\n        maxWidth: '420px',\r\n        height: '90vh',\r\n        maxHeight: '720px',\r\n        backgroundColor: theme.backgroundColor || '#ffffff',\r\n        borderRadius: theme.borderRadius || '16px',\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)',\r\n        transform: 'scale(0.95) translateY(10px)',\r\n        transition: 'transform 0.2s ease-out',\r\n      });\r\n    }\r\n\r\n    // Add close button if enabled\r\n    if (this.config.modal?.showCloseButton !== false) {\r\n      const closeButton = this.createCloseButton();\r\n      this.container.appendChild(closeButton);\r\n    }\r\n\r\n    this.overlay!.appendChild(this.container);\r\n  }\r\n\r\n  private createCloseButton(): HTMLButtonElement {\r\n    const button = document.createElement('button');\r\n    button.id = 'idv-sdk-close';\r\n    button.setAttribute('aria-label', 'Close verification');\r\n    button.innerHTML = '&#10005;';\r\n    button.style.fontSize = '16px';\r\n    button.style.fontWeight = 'bold';\r\n\r\n    Object.assign(button.style, {\r\n      position: 'absolute',\r\n      top: '12px',\r\n      right: '12px',\r\n      width: '30px',\r\n      height: '30px',\r\n      borderRadius: '50%',\r\n      border: 'none',\r\n      backgroundColor: 'rgba(0, 0, 0, 0.08)',\r\n      color: '#666666',\r\n      cursor: 'pointer',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      zIndex: '10',\r\n      transition: 'background-color 0.15s ease',\r\n    });\r\n\r\n    button.addEventListener('mouseenter', () => {\r\n      button.style.backgroundColor = 'rgba(0, 0, 0, 0.12)';\r\n    });\r\n\r\n    button.addEventListener('mouseleave', () => {\r\n      button.style.backgroundColor = 'rgba(0, 0, 0, 0.08)';\r\n    });\r\n\r\n    button.addEventListener('click', () => {\r\n      this.close('user_closed');\r\n    });\r\n\r\n    return button;\r\n  }\r\n\r\n  private createIframe(): void {\r\n    this.iframe = document.createElement('iframe');\r\n    this.iframe.id = 'idv-sdk-iframe';\r\n    this.iframe.src = this.config.iframeSrc;\r\n\r\n    // Mobile-friendly iframe attributes\r\n    this.iframe.setAttribute('allow', 'camera; microphone; fullscreen');\r\n    this.iframe.setAttribute('scrolling', 'yes');\r\n    this.iframe.setAttribute('frameborder', '0');\r\n\r\n    Object.assign(this.iframe.style, {\r\n      width: '100%',\r\n      height: '100%',\r\n      border: 'none',\r\n      display: 'block',\r\n      backgroundColor: '#ffffff',\r\n      // Fix iOS iframe scroll issues\r\n      WebkitOverflowScrolling: 'touch',\r\n      overflowY: 'auto',\r\n    });\r\n\r\n    this.container!.appendChild(this.iframe);\r\n  }\r\n\r\n  private attachEventListeners(): void {\r\n    // ESC key handler\r\n    if (this.config.modal?.closeOnEscape !== false) {\r\n      this.escHandler = (e: KeyboardEvent) => {\r\n        if (e.key === 'Escape') {\r\n          this.close('user_closed');\r\n        }\r\n      };\r\n      document.addEventListener('keydown', this.escHandler);\r\n    }\r\n\r\n    // Overlay click handler\r\n    if (this.config.modal?.closeOnOverlayClick) {\r\n      this.overlay!.addEventListener('click', (e: MouseEvent) => {\r\n        if (e.target === this.overlay) {\r\n          this.close('user_closed');\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private preventScroll(): void {\r\n    if (this.config.modal?.preventScroll !== false) {\r\n      this.originalOverflow = document.body.style.overflow;\r\n      document.body.style.overflow = 'hidden';\r\n\r\n      // Fix iOS body scroll issue\r\n      if (this.isMobile()) {\r\n        document.body.style.position = 'fixed';\r\n        document.body.style.width = '100%';\r\n        document.body.style.height = '100%';\r\n      }\r\n    }\r\n  }\r\n\r\n  private restoreScroll(): void {\r\n    if (this.config.modal?.preventScroll !== false) {\r\n      document.body.style.overflow = this.originalOverflow;\r\n\r\n      // Restore iOS body\r\n      if (this.isMobile()) {\r\n        document.body.style.position = '';\r\n        document.body.style.width = '';\r\n        document.body.style.height = '';\r\n      }\r\n    }\r\n  }\r\n\r\n  private animateIn(): void {\r\n    const mobile = this.isMobile();\r\n\r\n    // Force reflow\r\n    this.overlay!.offsetHeight;\r\n\r\n    requestAnimationFrame(() => {\r\n      if (this.overlay) {\r\n        this.overlay.style.opacity = '1';\r\n      }\r\n      if (this.container) {\r\n        this.container.style.transform = mobile\r\n          ? 'translateY(0)'\r\n          : 'scale(1) translateY(0)';\r\n      }\r\n    });\r\n  }\r\n\r\n  private animateOut(callback: () => void): void {\r\n    const mobile = this.isMobile();\r\n\r\n    if (this.overlay) {\r\n      this.overlay.style.opacity = '0';\r\n    }\r\n    if (this.container) {\r\n      this.container.style.transform = mobile\r\n        ? 'translateY(20px)'\r\n        : 'scale(0.95) translateY(10px)';\r\n    }\r\n\r\n    setTimeout(callback, 200);\r\n  }\r\n\r\n  private cleanup(): void {\r\n    // Remove ESC handler\r\n    if (this.escHandler) {\r\n      document.removeEventListener('keydown', this.escHandler);\r\n      this.escHandler = null;\r\n    }\r\n\r\n    // Remove overlay from DOM\r\n    if (this.overlay) {\r\n      this.overlay.remove();\r\n      this.overlay = null;\r\n    }\r\n\r\n    this.container = null;\r\n    this.iframe = null;\r\n    this.restoreScroll();\r\n  }\r\n}\r\n","import type {\r\n  IDVConfig,\r\n  IDVStartOptions,\r\n  VerificationComplete,\r\n  SDKError,\r\n  StepInfo,\r\n  CloseReason,\r\n} from './types';\r\nimport { ErrorCodes } from './types';\r\nimport { MessageBus } from './MessageBus';\r\nimport { ModalManager } from './ModalManager';\r\n\r\nconst SDK_VERSION = '1.0.0';\r\n\r\n/**\r\n * Main IDV SDK class\r\n */\r\nexport class IDVCore {\r\n  private config: IDVConfig | null = null;\r\n  private modalManager: ModalManager | null = null;\r\n  private messageBus: MessageBus | null = null;\r\n  private currentOptions: IDVStartOptions | null = null;\r\n  private startTime: number = 0;\r\n\r\n  /**\r\n   * Initialize the SDK with configuration\r\n   */\r\n  init(config: IDVConfig): void {\r\n    if (!config.apiKey) {\r\n      throw new Error('API key is required');\r\n    }\r\n\r\n    this.config = {\r\n      environment: 'production',\r\n      debug: false,\r\n      ...config,\r\n    };\r\n\r\n    if (this.config.debug) {\r\n      console.log('[IDV SDK] Initialized with config:', {\r\n        environment: this.config.environment,\r\n        apiKey: this.config.apiKey.substring(0, 10) + '...',\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start the verification flow\r\n   */\r\n  start(options: IDVStartOptions = {}): Promise<VerificationComplete> {\r\n    return new Promise((resolve, reject) => {\r\n      if (!this.config) {\r\n        const error: SDKError = {\r\n          code: ErrorCodes.NOT_INITIALIZED,\r\n          message: 'SDK not initialized. Call IDV.init() first.',\r\n          recoverable: false,\r\n        };\r\n        options.onError?.(error);\r\n        reject(error);\r\n        return;\r\n      }\r\n\r\n      if (this.modalManager?.isOpen()) {\r\n        const error: SDKError = {\r\n          code: ErrorCodes.ALREADY_OPEN,\r\n          message: 'Verification already in progress',\r\n          recoverable: false,\r\n        };\r\n        options.onError?.(error);\r\n        reject(error);\r\n        return;\r\n      }\r\n\r\n      this.currentOptions = options;\r\n      this.startTime = Date.now();\r\n\r\n      // Build iframe URL\r\n      const iframeSrc = this.buildIframeUrl(options);\r\n\r\n      // Set up message bus\r\n      const verifyOrigin = this.getVerifyOrigin();\r\n      this.messageBus = new MessageBus([verifyOrigin], this.config.debug);\r\n      this.setupMessageHandlers(resolve, reject);\r\n\r\n      // Create and open modal\r\n      this.modalManager = new ModalManager({\r\n        iframeSrc,\r\n        theme: options.theme,\r\n        modal: options.modal,\r\n        onClose: (reason: CloseReason) => {\r\n          this.handleClose(reason, reject);\r\n        },\r\n      });\r\n\r\n      this.modalManager.open();\r\n\r\n      if (this.config.debug) {\r\n        console.log('[IDV SDK] Modal opened with URL:', iframeSrc);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Close the verification modal\r\n   */\r\n  close(): void {\r\n    if (this.modalManager?.isOpen()) {\r\n      this.modalManager.close('user_closed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get SDK version\r\n   */\r\n  getVersion(): string {\r\n    return SDK_VERSION;\r\n  }\r\n\r\n  /**\r\n   * Check if SDK is initialized\r\n   */\r\n  isInitialized(): boolean {\r\n    return this.config !== null;\r\n  }\r\n\r\n  /**\r\n   * Check if verification is in progress\r\n   */\r\n  isOpen(): boolean {\r\n    return this.modalManager?.isOpen() ?? false;\r\n  }\r\n\r\n  private buildIframeUrl(options: IDVStartOptions): string {\r\n    const baseUrl = this.config!.baseUrl || this.getDefaultBaseUrl();\r\n\r\n    const params = new URLSearchParams({\r\n      'api-key': this.config!.apiKey,\r\n      'sdk-version': SDK_VERSION,\r\n      'origin': window.location.origin,\r\n    });\r\n\r\n    // Add user context\r\n    if (options.user?.id) params.set('user-id', options.user.id);\r\n    if (options.user?.email) params.set('user-email', options.user.email);\r\n    if (options.user?.name) params.set('user-name', options.user.name);\r\n\r\n    // Add verification options\r\n    if (options.country) params.set('country', options.country);\r\n    if (options.locale) params.set('locale', options.locale);\r\n    if (options.allowedDocumentTypes?.length) {\r\n      params.set('doc-types', options.allowedDocumentTypes.join(','));\r\n    }\r\n\r\n    // Add theme as base64 encoded JSON\r\n    if (options.theme && Object.keys(options.theme).length > 0) {\r\n      params.set('theme', btoa(JSON.stringify(options.theme)));\r\n    }\r\n\r\n    return `${baseUrl}/verify?${params.toString()}`;\r\n  }\r\n\r\n  private getDefaultBaseUrl(): string {\r\n    if (this.config!.environment === 'sandbox') {\r\n      return 'https://sandbox.trustcredo.com';\r\n    }\r\n    return 'https://76f7d5d0caed.ngrok-free.app';\r\n  }\r\n\r\n  private getVerifyOrigin(): string {\r\n    if (this.config!.baseUrl) {\r\n      return new URL(this.config!.baseUrl).origin;\r\n    }\r\n    return this.getDefaultBaseUrl();\r\n  }\r\n\r\n  private setupMessageHandlers(\r\n    resolve: (result: VerificationComplete) => void,\r\n    reject: (error: SDKError) => void\r\n  ): void {\r\n    if (!this.messageBus) return;\r\n\r\n    // Ready event\r\n    this.messageBus.on('IDV_READY', () => {\r\n      this.currentOptions?.onReady?.();\r\n    });\r\n\r\n    // Start event\r\n    this.messageBus.on('IDV_START', () => {\r\n      this.currentOptions?.onStart?.();\r\n    });\r\n\r\n    // Step event\r\n    this.messageBus.on('IDV_STEP', (payload) => {\r\n      this.currentOptions?.onStep?.(payload as StepInfo);\r\n    });\r\n\r\n    // Complete event\r\n    this.messageBus.on('IDV_COMPLETE', (payload) => {\r\n      const result = payload as VerificationComplete;\r\n      result.duration = Date.now() - this.startTime;\r\n\r\n      this.currentOptions?.onComplete?.(result);\r\n      this.modalManager?.close('completed');\r\n      this.cleanup();\r\n      resolve(result);\r\n    });\r\n\r\n    // Error event\r\n    this.messageBus.on('IDV_ERROR', (payload) => {\r\n      const error = payload as SDKError;\r\n      this.currentOptions?.onError?.(error);\r\n\r\n      if (!error.recoverable) {\r\n        this.modalManager?.close('error');\r\n        this.cleanup();\r\n        reject(error);\r\n      }\r\n    });\r\n\r\n    // Close event (from iframe)\r\n    this.messageBus.on('IDV_CLOSE', (payload) => {\r\n      const reason = (payload as { reason: CloseReason }).reason || 'user_closed';\r\n      this.modalManager?.close(reason);\r\n    });\r\n  }\r\n\r\n  private handleClose(reason: CloseReason, reject: (error: SDKError) => void): void {\r\n    this.currentOptions?.onClose?.(reason);\r\n\r\n    if (reason === 'user_closed') {\r\n      // User cancelled - reject with cancellation error\r\n      const error: SDKError = {\r\n        code: 'USER_CANCELLED',\r\n        message: 'Verification was cancelled by the user',\r\n        recoverable: true,\r\n      };\r\n      reject(error);\r\n    }\r\n\r\n    this.cleanup();\r\n  }\r\n\r\n  private cleanup(): void {\r\n    this.messageBus?.destroy();\r\n    this.messageBus = null;\r\n    this.modalManager = null;\r\n    this.currentOptions = null;\r\n  }\r\n}\r\n\r\n// Create singleton instance\r\nexport const IDV = new IDVCore();\r\n","/**\r\n * IDV SDK - Identity Verification SDK\r\n *\r\n * Usage:\r\n * ```html\r\n * <script src=\"https://cdn.trustcredo.com/sdk/v1/idv.min.js\"></script>\r\n * <script>\r\n *   IDV.init({ apiKey: 'pk_live_...' });\r\n *   IDV.start({ onComplete: (result) => console.log(result) });\r\n * </script>\r\n * ```\r\n *\r\n * Or with ES modules:\r\n * ```javascript\r\n * import { IDV } from '@anthropic/idv-sdk';\r\n * IDV.init({ apiKey: 'pk_live_...' });\r\n * ```\r\n */\r\n\r\nimport { IDV, IDVCore } from './IDV';\r\n\r\n// Export types\r\nexport type {\r\n  IDVConfig,\r\n  IDVStartOptions,\r\n  UserContext,\r\n  ThemeOptions,\r\n  ModalOptions,\r\n  StepInfo,\r\n  VerificationComplete,\r\n  SDKError,\r\n  CloseReason,\r\n} from './types';\r\n\r\nexport { ErrorCodes } from './types';\r\n\r\n// Export IDV instance and class\r\nexport { IDV, IDVCore };\r\n\r\n// Default export for UMD\r\nexport default IDV;\r\n"],"names":[],"mappings":"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"}